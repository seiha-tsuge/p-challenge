# 課題7

## 課題1

### 問題1

キャッシュを使うことで、リソースを持ったサーバーへのアクセスを減らすことができるため、通信量や通信時間などを節約することができる。

### 問題2

#### ローカルキャッシュ

ローカルキャッシュは、端末のストレージやメモリを利用するキャッシュで、
スマートフォンで端末にダウンロードしたデータを利用するのもローカルキャッシュの一種といえる。
主なローカルキャッシュはブラウザキャッシュで、多くの場合、
HTML/CSS/JavaScript/画像などをキャッシュすることで、これらの共通するコンテンツを毎回ネットワーク越しに取得する必要がなくなる。

#### 配信経路上のキャッシュ

配信経路上に配置されたキャッシュは、Proxy/CDN（主にCDN）を用いる。
CDNとはContent Delivery Networkの略で、グローバルにキャッシュサーバーを分散配置し、エンドユーザーに最も近い経路にあるキャッシュサーバーからコンテンツを配信する仕組み。
キャッシュサーバーを用いることで、リソースを持ったオリジンサーバーへのアクセスを減らすことができるため、通信量や通信時間などを節約することができる。

[参考: CDN](https://www.otsuka-shokai.co.jp/words/cdn.html)  
[参考: Webサイトの表⽰速度をCDN・キャッシュで改善して顧客を逃さない](https://www.ntt.com/bizon/network-ict_website-response.html)

#### プロキシキャッシュ

プロキシキャッシュは、プロキシサーバーを用いる。
基本的なプロキシサーバーの動作は、クライアントから受け取ったリクエストをオリジンサーバーに転送し、オリジンサーバーからのレスポンスをクライアントに転送する。
プロキシサーバーにキャッシュを保持することで、プロキシサーバーに再度同じリソース宛のリクエストがきた場合、キャッシュをレスポンスすることでオリジンサーバーへのアクセスを減らすことができる。  

プロキシキャッシュは、複数のクライアントに対してキャッシュされたコンテンツを配信する点は、前述したCDNを用いる経路上のキャッシュとほとんど同一である。
そのため、プロキシキャッシュは経路上のキャッシュとしても考えられる。
CDNとプロキシによるキャッシュの大きな違いは、ユーザーの近くに存在する可能性の高低である。
プロキシサーバーは構成的にオリジンサーバーの近くに展開することが多いため、たとえば、オリジンサーバーが日本にあると、プロキシサーバーにキャッシュしていても海外からのアクセスなどはそこまで効果的に処理できない。
一方、CDNはクライアントに近い場所でレスポンスすることができるため、プロキシサーバーより通信時間を節約できる可能性がある。

[参考: Web配信の技術―HTTPキャッシュ・リバースプロキシ・CDNを活用する](https://gihyo.jp/book/2021/978-4-297-11925-6)

### 問題3

#### Vary
> キャッシュからページを配信するかどうかを決定する際にユーザー エージェントを考慮する必要があることを、ISP などで使用されるキャッシュ サーバーに知らせます。Vary HTTP ヘッダーがないと、モバイル ユーザーにパソコン用 HTML ページのキャッシュが誤って配信される場合（またはその逆の場合）があります。

[動的な配信](https://developers.google.com/search/mobile-sites/mobile-seo/dynamic-serving?hl=ja#the-vary-http-header)

#### Cache-Control

ディレクティブと呼ばれるコマンドを指定することで、キャッシュの動作を指定する。
指定するディレクティブにはパラメータがあるものとないものがあり、複数のディレクティブを指定する場合には、カンマで区切る。
[Cache-Control](https://developer.mozilla.org/ja/docs/Web/HTTP/Headers/Cache-Control)

#### Expires

リソースの有効期限の日時を伝える。キャッシュサーバーが、Expiresを含んだレスポンスを受け取った場合、指定された日時までレスポンスのコピーを保持しておいて、リクエストにはキャッシュで応える。
指定日時を過ぎた場合には、リクエストが来た段階でオリジンサーバーにリソースを取得しに行く。

### 問題4

- ブラウザのキャッシュサイズの上限は、ユーザが自由に変更できます
  - キャッシュサイズの容量上限を超えると何が起きるでしょうか？容量上限はどの程度でしょうか？
    - ヒント：ブラウザにより挙動が異なります
    - 「上限に達したら何が起きるのか」「上限容量の感覚値」「ブラウザごとに差分があること」を認識してもらうのが目的のため、ブラウザのソースコードなどを読み解いて正確な値を調べていただく必要はございません！

### 問題5

あなたは、マイページ（ユーザの情報が動的に表示されるページ）の作成を任されました。マイページへのアクセスが多いことに気づいたあなたは、マイページをキャッシュしておくことを考えました。そこで「expires」ヘッダをレスポンスに含めることで、1週間程度はキャッシュを使用するように設定しました

### 問題6

すると先輩エンジニアに「動的なサイトをキャッシュするなら、expiresは使わない方が良いよ」と言われました。なぜでしょうか？どうすれば良いのでしょうか？

Expires ヘッダをつけてコンテンツを返却すると、指定された日時を過ぎるまでキャッシュを利用するため、オリジンサーバー上のコンテンツが更新されたとしても、更新内容を反映することができない。 
よって更新頻度が高い動的コンテンツにはexpiresは使わない方が良い

[参考: HTTPレスポンスヘッダ Expires とは？](https://weblabo.oscasierra.net/http-header-response-expires/)

### 問題7

- ブラウザのキャッシュがWEBサービスに用いられている実例を、3つ以上見つけて共有してください。どのような仕組みで対象がキャッシュされているのか、技術的な流れを説明してみてください
  - chromeの開発者コンソールの「ネットワーク」タブを使って探すのがオススメです
  - こんなスクリーンショットを撮ってみてください
  - https://drive.google.com/file/d/1OmrwTdmkMCA9cmbfWNyQKWJiJCsTQWuF/view

## 課題３

## 課題4

### クイズ1

### クイズ2

### クイズ3
