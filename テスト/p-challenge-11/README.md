# 課題 11

## 課題 1

### 問題 1

#### スナップショットテストとはなんでしょうか？説明してください

スナップショットテストとは、テストの対象になっている関数の出力を以前の出力と比較し、両者に差分があるかをテストする手法のこと。  
予め以前のバージョンの出力をスナップショットとして保存し、新しいバージョンの出力と比較し、差分が生じているのか検出する。  
特に React などのフレームワークで UI を生成するコードに対するテストとしてスナップショットテストが行われることが多い。

#### スナップショットテストを用いることで、どのような不具合が防止できるでしょうか？3 つほど例を挙げてみてください

- UI が予期せず変更されていないかを確かめるために非常に有用
- 変更の影響が大きなさまざまな改修プロジェクトにおいて、システムの振る舞いが変わらないことを確認できる
- Web サイトの機能を新しいアプリケーションサーバへと移行する場合、ユーザーには移行の前後で同じ内容のページが表示されるように保証することができる

[Software Design 連載 2021 年 10 月号 スナップショットテストの可能性を追求する](https://tech-blog.monotaro.com/entry/2021/10/21/090000)

#### スナップショットテストでは防止できない不具合もあります。3 つほど例を挙げてください

- テストを実行するタイミングにより出力が変化する機能
  - 現在時刻を表示するコンポーネント等
- ライブラリに依存している機能
  - 他言語対応で`react-intl`を使用しているとする。その場合、翻訳が変更されるとソースコードが変更されていなくてもスナップショットテストが失敗する可能性がある。
- スナップショットは HTML ベースの差分で、CSS 周りの差分が含まれず、UI の変化が確認できない

[スナップショットテストの向き不向きについて考えてみる](https://www.mizdra.net/entry/2021/02/04/003728)  
[ABEMA でスナップショットテストをやめて Visual Regression Testing に移行する話](https://developers.cyberagent.co.jp/blog/archives/29784/)  
[フロントエンドのスナップショットテスト](https://ichi.pro/furonto-endo-no-sunappushotto-tesuto-270085827256954)

## 課題 2

### 問題 2

#### どんな情報が記載されているでしょうか？

生成された`__snapshots__/Storyshots.test.js.snap`ファイルの中身は以下のように、各ストーリー（特定の状態で描画された要素）のスナップショットが作成されている。

```
exports[`Storyshots Board All O 1`] = `
<div> ...
</div>
`;

exports[`Storyshots Board All Tryangle 1`] = `
<div> ...
</div>
`;

exports[`Storyshots Board All X 1`] = `
<div> ...
</div>
`;
```

### 問題 3

#### スナップショットテストが落ちて、変更箇所が示されるはずです

<img width="360" alt="スクリーンショット 2022-01-01 14 32 35" src="https://user-images.githubusercontent.com/49358142/147844596-b9eacaa7-25ec-4286-97ee-f28003aac8a3.png">

#### 変更点をスナップショットに反映してみましょう

```
yarn test --updateSnapshot
```

## 課題 3

### クイズ 1

Storybook でスナップショットテストを行うアドオンは次のうちどれ？

- Storysource
- Storyshots
- Storycap

### クイズ 2

Jest におけるスナップショットテスト

アプリケーション全体の構築が必要となるグラフィカルな UI をレンダリングする代わりに、☆☆☆☆☆☆ 可能な React ツリーの値を素早く生成するテスト用レンダラーを利用できます。

☆☆☆☆☆☆ に入る言葉は何でしょう？

<details>
<summary>ヒント</summary>

[Jest におけるスナップショットテスト](https://jestjs.io/ja/docs/snapshot-testing#jest%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E3%82%B9%E3%83%8A%E3%83%83%E3%83%97%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%E3%83%86%E3%82%B9%E3%83%88)

</details>

### クイズ 3

Jest では、☆☆☆☆☆☆(クイズ 2 の回答)された値をどのように使用して、スナップショットテストを行いますか？

<details>
<summary>ヒント</summary>

[スナップショットテストとビジュアルの回帰テストの違いは何ですか？](https://jestjs.io/ja/docs/snapshot-testing#%E3%82%B9%E3%83%8A%E3%83%83%E3%83%97%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%E3%83%86%E3%82%B9%E3%83%88%E3%81%A8%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%AB%E3%81%AE%E5%9B%9E%E5%B8%B0%E3%83%86%E3%82%B9%E3%83%88%E3%81%AE%E9%81%95%E3%81%84%E3%81%AF%E4%BD%95%E3%81%A7%E3%81%99%E3%81%8B)

</details>
